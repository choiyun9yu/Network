# Cookie & Session

## 1. Cookie
쿠키는 클라이언트에 저장되는 키(key)와 값(value)이 들어있는 작은 데이터 파일이다. 이러한 쿠키는 클라이언트에 저장되어 필요시 정보를 참조하거나 재사용할 수 있다. 

### 1-1 쿠키를 사용하는 이유
보통 웹 환경에서는 클라이언트와 서버가 HTTP 프로토콜을 이용해 통신한다. 하지만 HTTP 프로토콜의 비연결성과 무상태성 때문에 쿠키를 사용한다.
- Connectionless(비연결성): HTTP는 TCP연결을 맺고 요청을 보내면 서버는 응답을 보내고 연결을 끊는다.
- Stateless(무상태): HTTP는 상태를 따로 저장하지 않는다. 연결이 끊어지는 순간 모든 상태 정보가 사라기게 된다. 따라서 서버는 클라이언트가 첫 번째 통신 때 보낸 정보를 두 번째 통신 때 알 수 없다.

### 1-2. 쿠키의 구성
- 이름: 쿠키를 구별하는 이름
- 값: 쿠키에 저장되는 값
- 유효시간: 쿠키 유지시간
- 도메인: 쿠키를 전송할 도메인
- 경로: 쿠키를 전송할 요청 경로

### 1-3. 쿠키 작동 방식
1) 클라이언트가 서버에 로그인 요청을 하는 경우 서버는 클라이언트의 요청을 받고 클라이언트의 정보를 담은 쿠키를 생성한다.

![image](https://github.com/choiyun9yu/Network/assets/110392046/9d970c31-7c64-4b08-9c5b-1fb15049f316)

2) 이후 HTTP 헤더에 set-cookie 옵션을 통해 쿠키를 포함한 응답을 보낸다.
3) 클라이언트는 해당 쿠키를 쿠키 저장소에 저장해둔다.  

![image](https://github.com/choiyun9yu/Network/assets/110392046/a20e22a9-6b7c-4450-bb8e-0aaa3f5030bc)

4) 클라이언트가 로그인을 완료하고 첫 페이지인 welcom 페이지에 접근한다.
5) 이때 클라이언트는 쿠키 저장소에 있는 쿠키를 꺼내 HTTP 요청에 쿠키를 담아 전송한다.
6) 그럼 서버는 HTTP 요청의 쿠키를 읽어 클라이언트를 식별할 수 있다.
7) 만약 쿠키가 없다면 다시 로그인 정보를 보내야하는 불편함이 있다.

<br>

## 2. Session
세션은 일정 기간 동안 같은 사용자(클라이언트)로 부터 들어오는 일련의 요구를 하나의 상태로 보고 그 상태를 일정하게 유지시키는 기술이다. 세션은 쿠키를 기반으로 하지만 쿠키와 다르게 서버 측에서 저장하고 관리한다. 서버는 세션 ID를 이용해 클라이언트를 구분하며, 웹 브라우저가 서버에 접속해 브라우저를 종료할 때까지 세션을 유지한다 

### 2-1. 세션 동작 방식
1) 클라이언트(웹 브라우저)가 서버에 로그인을 요청하는 경우 서버는 클라이언트의 요청을 받고 클라이언트 정보를 담은 세션을 생성한다.

![image](https://github.com/choiyun9yu/Network/assets/110392046/99bf7c8c-fec7-45e0-a9fb-fe6216d19d05)

2) 이후 세션 ID를 담은 쿠키를 생성하고, HTTP 헤더에 set-cookie 옵션을 통해 쿠키를 포함한 응답을 보낸다.
3) 클라이언트는 해당 쿠키를 쿠키 저장소에 저장해 놓는다.

![image](https://github.com/choiyun9yu/Network/assets/110392046/e545e58d-e1ca-4061-b3ec-adcc60069cb4)

4) 클라이언트가 로그인을 완료하고 첫 페이지인 welcome 페이지에 접근한다.
5) 이때 클라이언트는 쿠키 저장소에서 쿠키를 꺼내 HTTP 요청에 쿠키를 담아 전송한다.
6) 그럼 서버는 HTTP 요청의 쿠키를 읽어 쿠키 안의 세션 ID를 이용해 클라이언트를 식별할 수 있다. 

### 2-2. 쿠키와 세션의 차이
- 쿠키는 클라이언트에 저장되지만, 세션은 서버에 저장된다.
- 세션은 서버에 저장되므로 서버의 자원을 사용한다. 반면 쿠키는 클라이언트에 저장되므로 서버의 자원을 사용하지 않는다.
- 서버에 요청을 보내는 사용자가 많을 경우 세션은 부하가 심할 수 있다.
- 보안면에서 세션이 더 우수하다. 쿠키는 정보를 직접 저장하고 요청을 보낼 수 있다.
  만약 쿠키에 사용자의 주민번호 같은 민감한 정보를 그대로 담아 HTTP 요청을 보낸다고 하자. 이때 중간에 정보를 스니핑 당할 수 있다.
- 세션은 쿠키를 이용해 쿠키에 세션 ID만 저장하고 서버에서 세션을 처리하기 때문에 비교적 보안성이 좋다.
- 쿠키는 만료시간 동안 파일로 저장되므로 브라우저를 종료해도 정보가 남아있다.
- 세션은 브라우저가 종료되면 말료시간에 상관없이 삭제된다.

<br>

## 3. 쿠키 vs 세션 vs 토큰 
### 3-1. 쿠키
- 쿠키는 클라이언트(브라우저)에 저장되는 작은 데이터 조각이다.
- 웹 서버에서 생성되어 클라이언트에 저장되며, 이후 요청할 때마다 서버로 전송된다.
  - 용도: 사용자 식별, 세션 유지, 사용자 선호 설정 저장, 트래킹
  - 저장 위치: 클라이언트(브라우저)
  - 생명 주기: 마료 시간 설정 가능, 세션 쿠키는 브라우저가 닫힐 때까지 유지되고, 지속 쿠키는 만료 시간까지 유지
  - 보안: HTTPOnly(자바스크립트 접근불가), Secure(HTTPS에서만 전송), SameSite(CSRF 방지) 속성 설정 가능
  - 크기 제한: 쿠키 하나당 약 4KB

### 3-2. 세션
- 세션은 서버 측에서 사용자 데이터를 저장하여 상태를 유지하는 메커니즘이다.
- 클라이언트는 보통 세션 ID 를 쿠키에 저장하여 서버와 주고 받는다.
  - 용도: 로그인 상태 유지, 사용자 데이터 저장
  - 저장 위치: 서버
  - 생명 주기: 서버 설정에 따라 달라짐. 보통 일정 시간 동안 활동이 없으면 만료
  - 보안: 서버에 저장되므로 서버의 보안에 의존. 세션ID 가 탈취되면 세션 하이재킹 위험 
  - 크기 제한: 서버 메모라나 데이터베이스 용량에 따라 상이

### 3-3. 토큰 
- 토큰은 주로 JWT(JSON Web Token)와 같은 형식을 사용한다.
- 클라이언트와 서버 간의 인증 및 정보 교환을 위해 사용된다.
- 토큰은 서명되어 있어 변조를 방지할 수 있다.
  - 용도: 인증(주로 OAuth 2.0), 정보 교환
  - 저장 위치: 클라이언트(쿠키, 로컬 스토리지, 세션 스토리지 등)
  - 생명 주기: 발급 시 설정된 말료기간에 따름. 갱신 토큰(refresh token)을 사용해 만료된 토큰 재발급 가능
  - 보안: 서명되어 있어 변조 방지 가능. 그러나 저장 위치에 따라 XSS(Cross-Site Scripting) 등의 공격에 취약
  - 크기 제한: 토큰 자체는 비교적 작지만, JWT 의 경우 페이로드 크기에 따라 상이

### 3-4. 주요 차이점 요약
- 저장위치: 쿠키와 토큰은 클라이언트에 저장, 세션은 서버에 저장
- 생명 주기: 쿠키와 토큰은 설정된 만료시간 까지, 세션은 서버 설정에 따라 다름 
- 보안
  - 쿠키: HTTPOnly, Secure, SameSite 속성을 통해 보안 강화 가능
  - 세션: 서버에 저장되어 상대적으로 안전하지만, 세션 ID 탈취 위험
  - 토큰: 서명되어 변조 방지, 저장 위치에 따라 보안 취약점 존재
- 용도: 쿠키는 다양한 용도로 활용 가능, 세션은 주로 로그인 상태 유지, 토큰은 주로 인증 및 정보 교환 

